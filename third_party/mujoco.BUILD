load("@rules_cc//cc:defs.bzl", "cc_library")

cc_library(
    name = "mujoco",
    srcs = [
        # engine
        "src/engine/engine_callback.c",
        "src/engine/engine_collision_box.c",
        "src/engine/engine_collision_convex.c",
        "src/engine/engine_collision_driver.c",
        "src/engine/engine_collision_gjk.c",
        "src/engine/engine_collision_primitive.c",
        "src/engine/engine_collision_sdf.c",
        "src/engine/engine_core_constraint.c",
        "src/engine/engine_core_smooth.c",
        "src/engine/engine_core_util.c",
        "src/engine/engine_crossplatform.cc",
        "src/engine/engine_derivative.c",
        "src/engine/engine_derivative_fd.c",
        "src/engine/engine_forward.c",
        "src/engine/engine_init.c",
        "src/engine/engine_inverse.c",
        "src/engine/engine_io.c",
        "src/engine/engine_island.c",
        "src/engine/engine_memory.c",
        "src/engine/engine_name.c",
        "src/engine/engine_passive.c",
        "src/engine/engine_plugin.cc",
        "src/engine/engine_print.c",
        "src/engine/engine_ray.c",
        "src/engine/engine_sensor.c",
        "src/engine/engine_setconst.c",
        "src/engine/engine_sleep.c",
        "src/engine/engine_solver.c",
        "src/engine/engine_support.c",
        "src/engine/engine_util_blas.c",
        "src/engine/engine_util_container.c",
        "src/engine/engine_util_errmem.c",
        "src/engine/engine_util_misc.c",
        "src/engine/engine_util_solve.c",
        "src/engine/engine_util_sparse.c",
        "src/engine/engine_util_spatial.c",
        "src/engine/engine_vis_init.c",
        "src/engine/engine_vis_interact.c",
        "src/engine/engine_vis_visualize.c",
        # user
        "src/user/user_init.c",
        "src/user/user_api.cc",
        "src/user/user_cache.cc",
        "src/user/user_composite.cc",
        "src/user/user_flexcomp.cc",
        "src/user/user_mesh.cc",
        "src/user/user_model.cc",
        "src/user/user_objects.cc",
        "src/user/user_resource.cc",
        "src/user/user_util.cc",
        "src/user/user_vfs.cc",
        # xml
        "src/xml/xml.cc",
        "src/xml/xml_api.cc",
        "src/xml/xml_base.cc",
        "src/xml/xml_native_reader.cc",
        "src/xml/xml_native_writer.cc",
        "src/xml/xml_numeric_format.cc",
        "src/xml/xml_urdf.cc",
        "src/xml/xml_util.cc",
        # thread
        "src/thread/thread_pool.cc",
        "src/thread/thread_task.cc",
    ] + glob(
        [
            "src/cc/*.h",
            "src/engine/*.h",
            "src/user/*.h",
            "src/xml/*.h",
            "src/thread/*.h",
        ],
    ),
    hdrs = glob(["include/mujoco/*.h"]),
    copts = [
        "-fPIC",
    ],
    includes = [
        "include",
        "src",
    ],
    local_defines = [
        "mjUSEPLATFORMSIMD=0",
        "MUJOCO_DLL_EXPORTS",
        "_GNU_SOURCE",
        "CCD_STATIC_DEFINE",
        "MC_IMPLEM_ENABLE",
        "MUJOCO_TINYOBJLOADER_IMPL",
    ],
    visibility = ["//visibility:public"],
    deps = [
        "@ccd",
        "@lodepng",
        "@marchingcubecpp",
        "@qhull//:qhullstatic_r",
        "@tinyobjloader",
        "@tinyxml2",
        "@trianglemeshdistance",
    ],
)

filegroup(
    name = "humanoid_model",
    srcs = ["model/humanoid/humanoid.xml"],
    visibility = ["//visibility:public"],
)
